## 1. 权限模型介绍

权限管控可以通俗的理解为权力限制，即不同的人由于拥有不同权力，他所看到的、能使用的可能不一样。对应到一个应用系统，其实就是一个用户可能拥有不同的数据权限（看到的）和操作权限（使用的）。

主流的权限模型主要分为以下五种：

- **ACL模型**：访问控制列表
- **DAC模型**：自主访问控制
- **MAC模型**：强制访问控制
- **ABAC模型**：基于属性的访问控制
- **RBAC模型**：基于角色的权限访问控制



### 1.1 权限模型介绍

#### 1.1.1 ACL模型：访问控制列表

**Access Control List**，ACL是最早的、最基本的一种访问控制机制，是基于客体进行控制的模型，在其他模型中也有ACL的身影。为了解决相同权限的用户挨个配置的问题，后来也采用了用户组的方式。

**原理**：每一个客体都有一个列表，列表中记录的是哪些主体可以对这个客体做哪些行为，非常简单。

**例如**：当用户A要对一篇文章进行编辑时，ACL会先检查一下文章编辑功能的控制列表中有没有用户A，有就可以编辑，无则不能编辑。再例如：不同等级的会员在产品中可使用的功能范围不同。

**缺点**：当主体的数量较多时，配置和维护工作就会成本大、易出错。

#### 1.1.2 DAC模型：自主访问控制

Discretionary Access Control，DAC是ACL的一种拓展。

**原理**：在ACL模型的基础上，允许主体可以将自己拥有的权限自主地授予其他主体，所以权限可以任意传递。

**例如**：常见于文件系统，LINUX，UNIX、WindowsNT版本的操作系统都提供DAC的支持。

**缺点**：对权限控制比较分散，例如无法简单地将一组文件设置统一的权限开放给指定的一群用户。主体的权限太大，无意间就可能泄露信息。

#### 1.1.3 MAC模型：强制访问控制

**Mandatory Access Control**，MAC模型中主要的是双向验证机制。常见于机密机构或者其他等级观念强烈的行业，如军用和市政安全领域的软件。

**原理**：主体有一个权限标识，客体也有一个权限标识，而主体能否对该客体进行操作取决于双方的权限标识的关系。

**例如**：将军分为上将>中将>少将，军事文件保密等级分为绝密>机密>秘密，规定不同军衔仅能访问不同保密等级的文件，如少将只能访问秘密文件；当某一账号访问某一文件时，系统会验证账号的军衔，也验证文件的保密等级，当军衔和保密等级相对应时才可以访问。

**缺点**：控制太严格，实现工作量大，缺乏灵活性。

#### 1.1.4 ABAC模型：基于属性的访问控制

**Attribute-Based Access Control**，能很好地解决RBAC的缺点，在新增资源时容易维护。

**原理**：通过动态计算一个或一组属性是否满足某种机制来授权，是一种很灵活的权限模型，可以按需实现不同颗粒度的权限控制。

属性通常有四类：

1. 主体属性，如用户年龄、性别等；
2. 客体属性，如一篇文章等；
3. 环境属性，即空间限制、时间限制、频度限制；
4. 操作属性，即行为类型，如读写、只读等。

**例如**：早上9:0011:00期间A、B两个部门一起以考生的身份考试，下午14:0017:00期间A、B两个部门相互阅卷。

**缺点**：规则复杂，不易看出主体与客体之间的关系，实现非常难，现在应用的很少。

#### 1.1.5 RBAC，基于角色的权限访问控制

**Role-Based Access Control**，核心在于用户只和角色关联，而角色代表对了权限，是一系列权限的集合。

RBAC三要素：

1. **用户**：系统中所有的账户
2. **角色**：一系列权限的集合（如：管理员，开发者，审计管理员等）
3. **权限**：菜单，按钮，数据的增删改查等详细权限。

在**RBAC**中，权限与角色相关联，用户通过成为适当角色的成员而得到这些角色的权限。

角色是为了完成各种工作而创造，用户则依据它的责任和资格来被指派相应的角色，用户可以很容易地从一个角色被指派到另一个角色。

角色可依新的需求和系统的合并而赋予新的权限，而权限也可根据需要而从某角色中回收。角色与角色的关系同样也存在继承关系防止越权。

**优点**：便于角色划分，更灵活的授权管理；最小颗粒度授权；

![img](https://picgo-img-repo.oss-cn-beijing.aliyuncs.com/img/4364f6916e3d71f0d4957f4b8b470637.webp)



## 2. RBAC模型

RBAC模型可以分为：**RBAC0**、**RBAC1**、**RBAC2**、**RBAC3** 四个阶段，一般使用**RBAC0**的模型就可以。另外，**RBAC0**相当于底层逻辑，后三者都是在**RBAC0**模型上的拔高。

### 2.1 各种阶段的RBAC模型

#### 2.1.1 基础模型 - RBAC0

假设我们去设计一个权限系统，一定会有最基础的需求：给用户分配权限，一个用户可以被分配多个权限。其实这就是最简单的权限模型了，但有什么问题呢？

这种模型在只有几十个人的系统会很好维护，但对于具有成千上万用户的系统来说这就是一个灾难了，维护很困难。于是便在用户和权限之间引入了 **角色** 这个概念，这样只需要把权限授予给角色，不同的角色有不同的权限，而用户只需要关联某个角色就能完成整个流程了。

![base.png](https://picgo-img-repo.oss-cn-beijing.aliyuncs.com/img/76bb9af99d1c3a247b6fd4c9676f36b5.webp)

上述 **用户-角色-权限** 之间的关系其实就是 `RBAC` 最基础的模型了，它和 `Linux` 中的 **用户-用户组-权限** 很像，这样的好处就是可以批量调整权限了，比如某个角色某天需要添加别的权限时，只需要给角色绑定这个权限即可，而那些与这个角色关联的用户也便有了这个权限了。

#### 2.1.2 角色继承 - RBAC1

`RBAC0` 是最为经典且简单的模型，也是目前最通用的模型。但是对于复杂一点的业务这个模型就需要调整一下了，比如公司组织架构划分，这里面涉及到 **上下级** 的关系，而且高级别角色会向下兼容拥有低级别角色的权限，于是便有了基于 **角色继承** 的 `RBAC1` 模型。

![rbac1.png](https://picgo-img-repo.oss-cn-beijing.aliyuncs.com/img/509d1e8e36500632daaf5eb03b8944dc.webp)

这里的角色用图表示的话其实得用树状图，这里大家心里有个部门架构图就可以啦。

这个模型非常贴近现实业务的，比如公司的部门数据是不应该给所有员工看的，部门负责人是可以看本部门所有数据的，而小组长只能操作自己小组的数据，不能操作其他小组的数据。

#### 2.1.3 角色权限限制 - RBAC2

在 `RBAC1` 基础上其实已经难满足大部分业务了，但是实际生活中，难免会遇到这样的情况：

- 一个人不能 **同时** 扮演会计和审核员两个角色。
- 部门老大只有一个。
- 员工成为正式岗位前可能会经过实习期、试用期阶段，可用的权限不一样。

![rbac2.png](https://picgo-img-repo.oss-cn-beijing.aliyuncs.com/img/bd1759d77d6a9237fb30ecc71769acde.webp)

以上三个场景分为对应了：**角色互斥性、角色唯一性、角色先决条件** 等特征，这正是 `RBAC2` 模型的内容。这个模型的好处就是比如在使用某个系统的时候，不同角色操作同一份数据时可能存在冲突，此时需要限定同一时间只能使用一个身份进行数据操作。

#### 2.1.4 最全的模型 - RBAC3

`RBAC3` 它整合了前面三种模型，形成了一个十分完整的权限管理模型，既有等级分层也有角色约束，比如最常见的公司组织架构。